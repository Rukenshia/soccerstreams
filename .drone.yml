workspace:
  base: /go
  path: src/github.com/Rukenshia/soccerstreams

pipeline:
  dependencies:
    image: golang
    commands:
    - make deps

  test:
    group: qa
    image: golang
    commands:
    - make test

  lint:
    group: qa
    image: golang
    commands:
    - make lint || exit 0

  build-agent-bin:
    group: build
    image: ruken/docker-go-gcr
    gcr_service_account: ${gcr}
    commands:
    - make agent
  build-sweeper:
    group: build
    image: ruken/docker-go-gcr
    gcr_service_account: ${gcr}
    commands:
    - make sweeper
  build-web:
    group: build
    image: ruken/docker-go-gcr
    gcr_service_account: ${gcr}
    commands:
    - make web
  

  notify:
    branch: master
    image: appleboy/drone-telegram
    format: html
    secrets:
    - source: telegram_user
      target: telegram_to
    - source: telegram_token
      target: telegram_token
    when:
      status: [ success, failure ]
    message: |
      {{#success build.status}}
        &#x1F680 build {{repo.name}}#{{build.number}} succeeded.
      {{else}}
        &#x1F534 build {{repo.name}}#{{build.number}} failed.
      {{/success}}